<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>AWS Scout2 Report</title>

    <!-- custom style inline for now -->
    <style>
    .item-margin {
        margin-left: 25px;
    }
    .finding-danger {
        color:  red;
    }
    .finding-warning {
        color: orange;
    }
    ul.no-bullet {
        list-style-type: none;
    }
    .list-sub-element {
        border: 0 !important;
        padding-left: 25px;
    }
    </style>

    <!-- Bootstrap core CSS -->
    <link href="inc-bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="inc-bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="theme.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- jQuery -->
    <script src="inc-jquery/jquery-1.10.2.min.js"></script>

    <!-- Handlebars -->
    <script src="inc-handlebars/handlebars-v1.1.2.js"></script>


    <script>

        var violations_array = new Array();

        <!-- Generic load function -->
        function load_aws_config_from_json(list, keyword, cols) {
            var id1 = '#' + keyword + '-list-template';
            var id2 = keyword + 's-list';
            var tmp = Handlebars.compile($(id1).html());
            document.getElementById(id2).innerHTML = tmp({items: list});
            if (cols >= 2) {
                var id3 = '#' + keyword + '-detail-template';
                var id4 = keyword + 's-details';
                var tmp = Handlebars.compile($(id3).html());
                document.getElementById(id4).innerHTML = tmp({items: list});
            }
        }

        <!-- Generic highlight finding function -->
        function highlight_violations(violations) {
            for (i in violations) {
                var idprefix = violations[i]['keyword_prefix'] + '_' + violations[i]['entity'].split('.').pop();
                if (violations[i]['idprefix'] != '') {
                    var idprefix = idprefix + '-' + violations[i]['idprefix'];
                }
                var vkey = idprefix + '-' + i;
                violations_array[vkey] = new Array();
                for (j in violations[i]['items']) {
                    var id = vkey + '-' + violations[i]['items'][j];
                    var style = "finding-" + violations[i]['level'];
                    $('[id$="' + id + '"]').addClass(style);
                    violations_array[vkey].push(violations[i]['macro_items'][j]);
                }
            }
        }

        // TODO: Hide all by default

        <!-- Display functions -->
        function hideAll() {
            $("[id$='-row']").hide();
            $("[id*='-details-']").hide();
        }
        function hideRowItems(keyword) {
            $("[id*='" + keyword + "-list']").hide();
            $("[id*='" + keyword + "-details']").hide();
        }
        function showEmptyRow(keyword) {
            id = "#" + keyword + "s-row";
            $(id).show();
            hideRowItems(keyword);
        }
        function showItem(keyword, id) {
            var id1 = '[id="' + keyword + '-list-' + id + '"]';
            var id2 = '[id="' + keyword + '-details-' + id+ '"]';
            $(id1).show();
            $(id2).show();
        }
        function showRow(keyword) {
            id = "#" + keyword + "s-row";
            $(id).show();
        }
        function showRowWithDetails(keyword) {
            showRow(keyword);
            showAll(keyword);
        }
        function showAll(keyword) {
            $("[id*='" + keyword + "-list']").show();
            $("[id*='" + keyword + "-details']").show();
        }
        function toggleDetails(keyword, item) {
            var id = '#' + keyword + '-' + item;
            $(id).toggle();
        }
        function updateNavbar(active) {
            $('[id^="navbar-item-"]').removeClass('active');
            $('#navbar-item-'+active).addClass('active');
        }
        function toggleVisibility(id) {
            id1 = '#' + id;
            $(id1).toggle()
            id2 = '#bullet-' + id;
            if ($(id1).is(":visible")) {
                $(id2).html('<i class="glyphicon glyphicon-collapse-down"></i>');
            } else {
                $(id2).html('<i class="glyphicon glyphicon-expand"></i>');
            }
        }

        <!-- Navigation functions -->
        function browseTo(keyword, id) {
            hideAll();
            showRow(keyword);
            var html_id = "[id=\"" + keyword + "-details-" + id + "\"]";
            $(html_id).show();
            window.scrollTo(0,0);
        }
        function list_generic(keyword) {
            updateNavbar(keyword);
            hideAll();
            showRowWithDetails(keyword);
            window.scrollTo(0,0);
        }
        function list_findings(keyword_prefix, keyword, finding) {
            keyword = keyword_prefix + '_' + keyword;
            updateNavbar(keyword);
            hideAll();
            showEmptyRow(keyword);
            var violation_id = keyword + '-' + finding;
            for (item in  violations_array[violation_id]) {
                showItem(keyword, violations_array[violation_id][item]);
            }
            window.scrollTo(0,0);
        }

        <!-- Handlebars helpers -->
        Handlebars.registerHelper("decodeURIComponent", function(blob) {
            var test = decodeURIComponent(blob);
            test = test.replace(/ /g, '&nbsp;');
            test = test.replace(/\n/g, '<br />');
            return test;
        });
        Handlebars.registerHelper("has_profiles?", function(logins) {
            if(typeof logins != 'undefined' && logins != '') {
                return 'Yes';
            } else {
                return 'No';
            }
        });
        Handlebars.registerHelper('has_access_keys?', function(access_keys) {
            if (typeof access_keys != 'undefined' && access_keys != '') {
                return access_keys.length;
            } else {
                return 0;
            }
        });
        Handlebars.registerHelper('has_mfa?', function(mfa_devices, user_name) {
            if (typeof mfa_devices != 'undefined' && mfa_devices != '') {
                return 'Yes';
            } else {
                return '<span id="iam_user-no-mfa-' + user_name + '">No</span>';
            }
        });
        Handlebars.registerHelper('format_grant', function(grants) {
            if (grants.match(/.*\(.*\)/)) {
                return 'EC2 Group: ';
            } else {
                return 'Source IP: ';
            }
        });
        Handlebars.registerHelper('list_permissions', function(permissions) {
            var r = '';
            if (typeof permissions != 'undefined' && permissions != '') {
                r += parse_entities('group', permissions.groups);
                r += parse_entities('role', permissions.roles);
                r += parse_entities('user', permissions.users);
            }
            return r;
        });
        var gc = {}; gc['group'] = 0; gc['role'] = 0; gc['user'] = 0;
        function parse_entities(keyword, permissions) {
            var p = '';
            var r = '';
            for (i in permissions) {
                p += format_entity(keyword, permissions[i].name, permissions[i].policy_name, gc[keyword]++);
            }
            if (p != '') {
                r = '<p>' + keyword.charAt(0).toUpperCase() + keyword.slice(1) + 's:</p><ul>' + p + '</ul>';
            }
            return r;
        }
        function format_entity(keyword, name, policy_name, c) {
            var r = '';
            r += "<li>" + name + " [<a href=\"javascript:toggleDetails('" + keyword + "'," + c + ")\">Details</a>]";
            r += "<div class=\"row\" style=\"display:none\" id=\"" + keyword + "-" + c + "\">" + policy_name + "</div></li>";
            return r;
        }
        Handlebars.registerHelper('list_group_instances', function(group_id, running, stopped) {
            var rc = count_instances(running);
            var sc = count_instances(stopped);
            var r = '';
            r += format_instances(group_id, running, rc, 'Running');
            r += format_instances(group_id, stopped, sc, 'Stopped');
            return r;
        });
        function count_instances(instances) {
            if (typeof instances != 'undefined' && instances != '') {
                return instances.length;
            } else {
                return 0;
            }
        }
        function format_instances(group_id, instances, count, title) {
            var r = '';
            r += '<ul class="no-bullet">';
            if (count > 0) {
                r += '<li>';
                r += '<a href="javascript:toggleVisibility(\'ec2_instances-' + group_id + '-' + title +'\')">';
                r += '<span id="bullet-ec2_instances-' + group_id + '-' + title + '">';
                r += '<i class="glyphicon glyphicon-expand"></i></span></a> ';
                r += title + ': ' + count;
                r += '</li><div id="ec2_instances-' + group_id + '-' + title +'"><ul>';
                for (i in instances) {
                    r += '<li class="list-group-item-text"><a href="javascript:browseTo(\'ec2_instance\',\'' + instances[i] + '\')">' + instances[i] + '</a></li>';
                }
                r += '</ul></div>';
            } else {
                r += '<li>' + title + ': ' + count + '</li>';
            }
            r += '</ul>';
            return r;
        }
        Handlebars.registerHelper('format_grants', function(bucket_name, grants) {
            r = '';
            for (g in grants) {
                r += list_s3_permissions(bucket_name, g, grants[g]);
            }
            return r;
        });
        function list_s3_permissions(bucket_name, grantee_name, grants) {
            var r = '';
            r += '<tr><td width="20%">' + grantee_name + '</td>';
            for (grant in grants) {
                r += '<td width="20%" class="text-center">' + format_s3_grant(bucket_name, grantee_name, grant, grants[grant]) + '</td>';
            }
            r += '</tr>';
            return r;
        }
        function format_s3_grant(bucket_name, grantee_name, grant, value) {
            var icon = '<i class="' + ((value == true) ? 'glyphicon glyphicon-ok' : '') +'"></i>';
            if (grantee_name == 'All users') {
                return '<span id="s3_bucket-world-' + grant + '-' + bucket_name + '">' + icon + '</span>';
            } else {
                return icon;
            }
        }
        Handlebars.registerHelper('has_logging?', function(logging) {
            return logging;
        });
        Handlebars.registerHelper('format_finding_menu', function(key, finding) {
            r = '';
            if (finding['macro_items'].length != 0) {
                r += '<li>';
                r += '<a href="javascript:list_findings(\'' + finding['keyword_prefix'] + '\',\'' + finding['entity'].split('.').pop() + '\',\'' + key + '\')">';
                r += finding['description'] + ' (' + finding['macro_items'].length + ')';
                r += '</a></li>';
            }
            return r;
        });
        Handlebars.registerHelper('format_users', function(users) {
            var len = users.length;
            if (len == 0) {
                return '';
            }
            len = len % 3;
            r = '<table width="100%" class="table">';
            for (u in users) {
                if (u%3 == 0) {
                    r += '<tr>';
                }
                r += '<td width="33%" style="padding-left: 10px; text-align: center;"><a href="javascript:browseTo(\'iam_user\', \'' + users[u] + '\')">' + users[u] + '</td>';
                if (u%3 == 2) {
                    r += '</tr>';
                }
            }
            if (len != 0) {
                for (i = len; i <3; i++) {
                    r += '<td width="33%" style="padding-left: 10px; text-align: center;"></td>';
                }
                r += '</tr>';
            }
            r += '</table>';
            return r;
        });
        Handlebars.registerHelper('count', function(items) {
            var c = 0;
            for (i in items) {
                c = c + 1;
            }
            return c;
        });
        Handlebars.registerHelper('count_sg', function(regions) {
            var sgc = 0;
            for (r in regions) {
                for (vpc in regions[r]) {
                    for (sg in regions[r][vpc]) {
                        sgc = sgc +1;
                    }
                }
            }
            return sgc;
        });
        Handlebars.registerHelper('count_acl', function(regions) {
            var aclc = 0;
            for (r in regions) {
                for (vpc in regions[r]) {
                    for (acl in regions[r][vpc]['network_acls']) {
                        aclc = aclc +1;
                    }
                }
            }
            return aclc;
        });
        Handlebars.registerHelper('format_network_acls', function (acls, direction) {
            r = '<table class="table-striped" width="100%">';
            r += '<tr><td width="20%" class="text-center">Rule number</td>';
            r += '<td width="20%" class="text-center">Port</td>';
            r += '<td width="20%" class="text-center">Protocol</td>';
            r += '<td width="20%" class="text-center">' + direction + '</td>';
            r += '<td width="20%" class="text-center">Action</td></tr>';
            for (a in acls) {
                r += '<tr>';
                r += '<td width="20%" class="text-center">' + acls[a]['rule_number'] + '</td>';
                r += '<td width="20%" class="text-center">' + acls[a]['port_range'] + '</td>';
                r += '<td width="20%" class="text-center">' + acls[a]['protocol'] + '</td>';
                r += '<td width="20%" class="text-center">' + acls[a]['cidr_block'] + '</td>';
                r += '<td width="20%" class="text-center">' + acls[a]['rule_action'] + '</td>';
                r += '</tr>';
            }
            r += '</table>';
            return r;
        });
        Handlebars.registerHelper('ifPasswordAndKey', function(logins, access_keys, block) {
            if ((typeof logins != 'undefined' && logins != '') && (typeof access_keys != 'undefined' && access_keys != '')) {
                return block.fn(this);
            } else {
                return block.inverse(this);
            }
        });

        <!-- Debug -->
        Handlebars.registerHelper('helpme', function(permission) {
            return xinspect(permission);
        });
        function xinspect(o,i){
            if (typeof i == 'undefined') i='';
            if (i.length > 50) return '[MAX ITERATIONS]';
            var r=[];
            for(var p in o){
                var t=typeof o[p];
                r.push(i+'"'+p+'" ('+t+') => '+(t=='object' ? 'object:'+xinspect(o[p],i+'  ') : o[p]+''));
            }
            return r.join(i+'\n');
        }

    </script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <span class="navbar-brand">AWS Scout</span>
        </div>
        <div class="navbar-collapse collapse">
          <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="javascript:show_ec2()" class="dropdown-toggle" data-toggle="dropdown">EC2<b class="caret"></b></a>
              <ul class="dropdown-menu" id="ec2_violations-list">
                <script id="ec2_violation-list-template" type="text/x-handlebars-template">
                  <li><a href="javascript:list_generic('ec2_instance')">Instances</a></li>
                  <li><a href="javascript:list_generic('ec2_network_acl')">Network ACLs</a></li>
                  <li><a href="javascript:list_generic('ec2_security_group')">Security Groups</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Security risks</li>
                  {{#each items}}
                    {{{format_finding_menu @key this}}}
                  {{/each}}
                </script>
              </ul>
            <li class="dropdown">
              <a href="javascript:show_iam()" class="dropdown-toggle" data-toggle="dropdown">IAM<b class="caret"></b></a>
              <ul class="dropdown-menu" id="iam_violations-list">
                <script id="iam_violation-list-template" type="text/x-handlebars-template">
                  <li><a href="javascript:list_generic('iam_group')">Groups</a></li>
                  <li><a href="javascript:list_generic('iam_permission')">Permissions</a></li>
                  <li><a href="javascript:list_generic('iam_role')">Roles</a></li>
                  <li><a href="javascript:list_generic('iam_user')">Users</a></li>
                  <li><a href="#">Password policy</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Security risks</li>
                  {{#each items}}
                    {{{format_finding_menu @key this}}}
                  {{/each}}
                </script>
              </ul>
            </li>
            <li class="dropdown">
              <a href="javascript:show_s3()" class="dropdown-toggle" data-toggle="dropdown">S3<b class="caret"></b></a>
              <ul class="dropdown-menu" id="s3_violations-list">
                <script id="s3_violation-list-template" type="text/x-handlebars-template">
                  <li><a href="javascript:list_generic('s3_bucket')">Buckets</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Security risks</li>
                  {{#each items}}
                    {{{format_finding_menu @key this}}}
                  {{/each}}
                </script>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Help<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#">About AWS Scout2</a></li>
                <li><a href="#">Security findings</a></li>
                <li><a href="#">Related documentation</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
          </ul>
          </div>
        </div><!--/.nav-collapse -->
      </div>

    </div>

    <div class="container theme-showcase" id="container-user">

      <div class="page-header">
      </div>

      <!-- Template for EC2 instances -->
      <div class="row" id="ec2_instances-row">
        <div class="col-sm-4">
          <ul class="list-group" id="ec2_instances-list">
            <script id="ec2_instance-list-template" type="text/x-handlebars-template">
            <li class="list-group-item"><a href="javascript:showAll('ec2_instance')">Show all <span class="badge pull-right">{{count items}}</span></a></li>
            {{#each items}}
              <li class="list-group-item">
                <a href="javascript:browseTo('ec2_instance','{{@key}}')">{{@key}}</a>
              </li>
            {{/each}}
            </script>
          </ul>
        </div>
        <div class="col-sm-8" id="ec2_instances-details">
          <script id="ec2_instance-detail-template" type="text/x-handlebars-template">
          {{#each items}}
          <div class="list-group" id="ec2_instance-details-{{{id}}}">
            <div class="list-group-item active">
              <h4 class="list-group-item-heading">{{{id}}}</h4>
            </div>
            <div class="list-group-item">
              <h4>Information</h4>
              <ul>
                <li class="list-group-item-text">Region: {{{region}}}</li>
                <li class="list-group-item-text">Reservation ID: {{{reservation_id}}}</li>
                <li class="list-group-item-text">Access Key name: {{{key_name}}}</li>
                <li class="list-group-item-text">State: {{{state}}}</li>
                <li class="list-group-item-text">Up since: {{{launch_time}}}</li>
              </ul>
            </div>
            <div class="list-group-item">
              <h4>Network</h4>
              <ul>
                <li class="list-grou-item-text">Public IP: {{{ip_address}}}</li>
                <li class="list-grou-item-text">Public DNS: {{{public_dns_name}}}</li>
                <li class="list-grou-item-text">Private IP: {{{private_ip_address}}}</li>
                <li class="list-grou-item-text">Private DNS: {{{private_dns_name}}}</li>
              </ul>
            </div>
          </div>
          {{/each}}
          </script>
        </div><!-- /.col-sm-8 -->
      </div><!-- /.row -->

      <!-- Template for EC2 network acls -->
      <div class="row" id="ec2_network_acls-row">
        <div class="col-sm-4" id="ec2_network_acls-list">
          <script id="ec2_network_acl-list-template" type="text/x-handlebars-template">
            <ul class="list-group">
              <li class="list-group-item"><a href="javascript:showAll('ec2_network_acl')">Show all <span class="badge pull-right">{{count_acl items}}</span></a></li>
            </ul>
            {{#each items}}
            <ul class="list-group">
              <li class="list-group-item active"><a style="color: black" href="javascript:toggleVisibility('ec2_region-list-{{@key}}')">{{@key}}</a></li>
              <div id="ec2_region-list-{{@key}}">
                {{#each this}}
                  <li class="list-group-item" id="ec2_vpc-list-{{@key}}"><a href="javascript:browseTo('ec2_network_acl','{{@key}}')">{{@key}}</a> ({{cidr_block}})</li>
                {{/each}}
              </div>
            </ul>
            {{/each}}
          </script>
        </div>
        <div class="col-sm-8" id="ec2_network_acls-details">
          <script id="ec2_network_acl-detail-template" type="text/x-handlebars-template">
          {{#each items}}
            {{#each this}}
            <div class="list-group" id="ec2_network_acl-details-{{@key}}">
              <div class="list-group-item active">
                <h4 class="list-group-item-heading">Virtual Private Cloud {{@key}}</h4>
              </div>
              {{#each network_acls}}
                <div class="list-group-item">
                  <h4 class="list-group-item-heading">Inbound rules</h4>
                  {{{format_network_acls inbound_network_acls 'Source'}}}
                </div>
                <div class="list-group-item">
                  <h4 class="list-group-item-heading">Outbound rules</h4>
                  {{{format_network_acls outbound_network_acls 'Destination'}}}
                </div>
              {{/each}}
              </div>
            </div>
            {{/each}}
          {{/each}}
          </script>
        </div><!-- /.col-sm-8 -->
      </div><!-- /.row -->

      <!-- Template for EC2 security groups -->
      <div class="row" id="ec2_security_groups-row">
        <div class="col-sm-4" id="ec2_security_groups-list">
          <script id="ec2_security_group-list-template" type="text/x-handlebars-template">
            <ul class="list-group">
              <li class="list-group-item"><a href="javascript:showAll('ec2_security_group')">Show all security groups<span class="badge pull-right">{{count_sg items}}</span></a></li>
            </ul>
            {{#each items}}
            <ul class="list-group">
              <li class="list-group-item active"><a style="color: black" href="javascript:toggleVisibility('ec2_region-list-{{@key}}')">{{@key}}</a></li>
              <div id="ec2_region-list-{{@key}}">
                {{#each this}}
                  <li class="list-group-item" id="ec2_vpc-list-{{@key}}">{{@key}}
                    {{#each this}}
                      <div class="list-group-item list-sub-element" id="ec2_security_group-list-{{@key}}">
                        <a href="javascript:browseTo('ec2_security_group','{{id}}')">{{@key}}</a>
                      </div>
                    {{/each}}
                  </li>
                {{/each}}
              </div>
            </ul>
            {{/each}}
          </script>
        </div>
        <div class="col-sm-8" id="ec2_security_groups-details">
          <script id="ec2_security_group-detail-template" type="text/x-handlebars-template">
          {{#each items}}
            {{#each this}}
              {{#each this}}
                <div class="list-group" id="ec2_security_group-details-{{{id}}}">
                  <div class="list-group-item active">
                    <h4 class="list-group-item-heading">{{@key}} {{{name}}} ({{{id}}})</h4>
                    <p class="list-group-item-text">{{{description}}}</p>
                  </div>
                  <div class="list-group-item">
                    <h4 class="list-group-item-heading">Rules</h4>
                    <ul>
                    {{# each protocols}}
                      <li class="list-group-item-text">{{{name}}}</li>
                      <ul>
                      {{# each rules}}
                        <li class="list-group-item-text">Ports: <span id="ec2_security_group-{{../name}}-{{ports}}-{{../../id}}">{{ports}}</span></li>
                        <ul>
                        {{# each grants}}
                          <li class="list-group-item-text">{{format_grant this}}<span id="ec2_security_group-{{../../name}}-{{../ports}}-{{this}}-{{../../../id}}">{{this}}</span></li>
                        {{/each}}
                        </ul>
                      {{/each}}
                      </ul>
                    {{/each}}
                    </ul>
                  </div>
                  <div class="list-group-item">
                    <h4 class="list-group-item-heading">Instances</h4>
                    {{{list_group_instances id running-instances stopped-instances}}}
                  </div>
                </div>
              {{/each}}
            {{/each}}
          {{/each}}
          </script>
        </div><!-- /.col-sm-8 -->
      </div><!-- /.row -->

      <!-- Template for IAM groups -->
      <div class="row" id="iam_groups-row">
        <div class="col-sm-4">
          <ul class="list-group" id="iam_groups-list">
            <script id="iam_group-list-template" type="text/x-handlebars-template">
            <li class="list-group-item"><a href="javascript:showAll('iam_group')">Show all <span class="badge pull-right">{{items.length}}</span></a></li>
            {{#each items}}
              <li class="list-group-item" id="iam_group-list-{{{group_id}}}">
                <a href="javascript:browseTo('iam_group','{{{group_id}}}')">{{{group_name}}}</a>
              </li>
            {{/each}}
            </script>
          </ul>
        </div>
        <div class="col-sm-8" id="iam_groups-details">
          <script id="iam_group-detail-template" type="text/x-handlebars-template">
          {{#each items}}
          <div class="list-group" id="iam_group-details-{{{group_id}}}">
            <div class="list-group-item active">
              <h4 class="list-group-item-heading">{{{group_name}}}</h4>
              <p class="list-group-item-text"> * Group created on {{{create_date}}}</p>
            </div>
            <div class="list-group-item" style="padding-bottom: 0 !important;">
              <h4 class="list-group-item-heading">Members</h4>
              {{{format_users users}}}
            </div>
            <div class="list-group-item">
              <h4 class="list-group-item-heading">Group Policies</h4>
              <ul>
              {{#each policies}}
                <li class="list-group-item-text">
                {{{policy_name}}} [<a href="javascript:toggleDetails('iam_group_policy_details','{{{policy_name}}}')">Details</a>]
                <p class="list-group-item-text" id="iam_group_policy_details-{{{policy_name}}}" style="display:none">{{{decodeURIComponent policy_document}}}</p>
                </li>
              {{/each}}
              </ul>
            </div>
          </div>
          {{/each}}
          </script>
        </div><!-- /.col-sm-8 -->
      </div><!-- /.row -->

      <!-- Template for IAM permissions -->
      <div class="row" id="iam_permissions-row">
        <div id="iam_permissions-list"></div>
          <script id="iam_permission-list-template" type="text/x-handlebars-template">
          <div class="row list-group-item active">
            <div class="col-sm-4"><h4>Permission</h4></div>
            <div class="col-sm-4"><h4>Allow</h4></div>
            <div class="col-sm-4"><h4>Deny</h4></div>
          </div>
          {{#each items}}
            <div class="row list-group-item" id="iam_permission-details-{{{@key}}}">
              <div class="col-sm-4">{{{@key}}}</div>
              <div class="col-sm-4">{{{list_permissions Allow}}}</div>
              <div class="col-sm-4">{{{list_permissions Deny}}}</div>
            </div>
          {{/each}}
          </script>
      </div><!-- /.row -->

      <!-- Template for IAM roles -->
      <div class="row" id="iam_roles-row">
        <div class="col-sm-3">
          <ul class="list-group" id="iam_roles-list">
            <script id="iam_role-list-template" type="text/x-handlebars-template">
            <li class="list-group-item"><a href="javascript:showAll('iam_role')">Show all <span class="badge pull-right">{{items.length}}</span></a></li>
            {{#each items}}
              <li class="list-group-item" id="iam_role-list-{{{role_id}}}">
                <a href="javascript:browseTo('iam_role','{{{role_id}}}')">{{{role_name}}}</a>
              </li>
            {{/each}}
            </script>
          </ul>
        </div>
        <div class="col-sm-8" id="iam_roles-details">
          <script id="iam_role-detail-template" type="text/x-handlebars-template">
          {{#each items}}
          <div class="list-group" id="iam_role-details-{{{role_id}}}">
            <div class="list-group-item active">
              <h4 class="list-group-item-heading">{{{role_name}}}</h4>
            </div>
            <div class="list-group-item">
              <h4 class="list-group-item-heading">Information</h4>
              <ul>
                <li class="list-group-item-text"> Role created on {{{create_date}}}</li>
              </ul>
            </div>
            <div class="list-group-item">
              <h4 class="list-group-item-heading">Role Policies</h4>
              <div>
              <ul>
              {{#each policies}}
                <li class="list-group-item-text">
                {{{policy_name}}} [<a href="javascript:toggleDetails('iam_role_policy_details','{{{policy_name}}}')">Details</a>]
                <p class="list-group-item-text" id="iam_role_policy_details-{{{policy_name}}}" style="display:none">{{{decodeURIComponent policy_document}}}</p>
                </li>
              {{/each}}
              </ul>
              </div>
            </div>
          </div>
          {{/each}}
          </script>
        </div><!-- /.col-sm-8 -->
      </div><!-- /.row -->

      <!-- Template for IAM users -->
      <div class="row" id="iam_users-row">
        <div class="col-sm-4">
          <ul class="list-group" id="iam_users-list">
            <script id="iam_user-list-template" type="text/x-handlebars-template">
            <li class="list-group-item"><a href="javascript:showAll('iam_user')">Show all <span class="badge pull-right">{{items.length}}</span></a></li>
            {{#each items}}
              <li class="list-group-item" id="iam_user-list-{{{user_name}}}">
                <a href="javascript:browseTo('iam_user','{{{user_name}}}')">{{{user_name}}}</a>
              </li>
            {{/each}}
            </script>
          </ul>
        </div>
        <div class="col-sm-8" id="iam_users-details">
          <script id="iam_user-detail-template" type="text/x-handlebars-template">
          {{#each items}}
          <div class="list-group" id="iam_user-details-{{{user_name}}}">
            <div class="list-group-item active">
              <h4 class="list-group-item-heading">{{{user_name}}}</h4>
              <p class="list-group-item-text"> * Account created on {{{create_date}}}</p>
            </div>
            <div class="list-group-item">
              <h4 class="list-group-item-heading">Authentication methods</h4>
              <p class="list-group-item-text">Password enabled: {{{has_profiles? logins}}}</p>
              <ul></ul>
              <p class="list-group-item-text">Multi-Factor enabled: {{{has_mfa? mfa_devices user_name}}}</p>
              <ul>
              {{#each mfa_devices}}
                <li class="list-group-item-text"> Serial number: {{{serial_number}}}</li>
              {{/each}}
              </ul>
              <p class="list-group-item-text">Access Keys: {{{has_access_keys? access_keys}}}</p>
              <ul>
              {{#each access_keys}}
                <li class="list-group-item-text"><span id="iam_user-{{status}}-key-no-rotation-{{access_key_id}}">{{access_key_id}}, {{status}}, created on {{create_date}}</span></li>
              {{/each}}
              </ul>
              {{#ifPasswordAndKey logins access_keys}}
                <p class="list-group-item-text">
                <span id="iam_user-password-and-key-{{{user_name}}}"><i class="glyphicon glyphicon-warning-sign"></i> Review the need for password-based and key-based authentication</span>
                </p>
              {{/ifPasswordAndKey}}
            </div>
            <div class="list-group-item">
              <h4 class="list-group-item-heading">Groups</h4>
              <ul>
              {{#each groups}}
                <li class="list-group-item-text"><a href="javascript:browseTo('iam_group','{{{group_id}}}')">{{{group_name}}}</a></li>
              {{/each}}
              </ul>
            </div>
            <div class="list-group-item">
              <h4 class="list-group-item-heading">User Policies</h4>
              <div>
              <ul>
              {{#each policies}}
                <li class="list-group-item-text">
                {{{policy_name}}} [<a href="javascript:toggleDetails('iam_user_policy_details','{{{policy_name}}}')">Details</a>]
                <p class="list-group-item-text" id="iam_user_policy_details-{{policy_name}}" style="display:none">{{{decodeURIComponent policy_document}}}</p>
                </li>
              {{/each}}
              </ul>
              </div>
            </div>
          </div>
          {{/each}}
          </script>
        </div><!-- /.col-sm-8 -->
      </div><!-- /.row -->

      <!-- Template for S3 buckets -->
      <div class="row" id="s3_buckets-row">
        <div class="col-sm-4">
          <ul class="list-group" id="s3_buckets-list">
            <script id="s3_bucket-list-template" type="text/x-handlebars-template">
            <li class="list-group-item"><a href="javascript:showAll('s3_bucket')">Show all <span class="badge pull-right">{{items.length}}</span></a></li>
            {{#each items}}
              <li class="list-group-item" id="s3_bucket-list-{{@key}}">
                <a href="javascript:browseTo('s3_bucket','{{@key}}')">{{@key}}</a>
              </li>
            {{/each}}
            </script>
          </ul>
        </div>
        <div class="col-sm-8" id="s3_buckets-details">
          <script id="s3_bucket-detail-template" type="text/x-handlebars-template">
          {{#each items}}
          <div class="list-group" id="s3_bucket-details-{{@key}}">
            <div class="list-group-item active">
              <h4 class="list-group-item-heading">{{@key}}</h4>
            </div>
            <div class="list-group-item">
              <h4 class="list-group-item-heading">Information</h4>
              <div class="list-group-item-text item-margin">Creation date: {{{creation_date}}}</div>
              <div class="list-group-item-text item-margin">Region: {{{region}}}</div>
              <div class="list-group-item-text item-margin">Logging: {{{has_logging? logging}}}</div>
              <div class="list-group-item-text item-margin">Versioning: {{{versioning}}}</div>
            </div>
            <div class="list-group-item">
              <h4 class="list-group-item-heading">Permissions</h4>
              <table class="table-striped" width="100%" >
                <tr>
                  <td width="20%"></td>
                  <td width="20%" class="text-center">Read access</td>
                  <td width="20%" class="text-center">Write access</td>
                  <td width="20%" class="text-center">Read ACP</td>
                  <td width="20%" class="text-center">Write ACP</td>
                </tr>
                {{{format_grants @key grants}}}
              </table>
            </div>
          </div>
          {{/each}}
          </script>
        </div><!-- /.col-sm-8 -->
      </div><!-- /.row -->

    </div> <!-- /container -->

    <!-- Load EC2 data -->
    <script src="json/aws_ec2_security_groups.js"></script>
    <script src="json/aws_ec2_instances.js"></script>
    <script src="json/aws_ec2_network_acls.js"></script>
    <script src="json/aws_ec2_violations.js"></script>

    <!-- Load IAM data -->
    <script src="json/aws_iam_groups.js"></script>
    <script src="json/aws_iam_permissions.js"></script>
    <script src="json/aws_iam_roles.js"></script>
    <script src="json/aws_iam_users.js"></script>
    <script src="json/aws_iam_violations.js"></script>

    <!-- Load S3 data -->
    <script src="json/aws_s3_buckets.js"></script>
    <script src="json/aws_s3_violations.js"></script>

    <!-- Violations -->

    <!-- Bootstrap core JavaScript, placed at the end of the document so the pages load faster -->
    <script src="inc-bootstrap/js/bootstrap.min.js"></script>

  </body>
</html>
